#!/bin/bash

# Function to switch to Eduroam
switch_to_eduroam() {
    echo "Switching to Eduroam..."
    # Stop hostapd and dnsmasq
    sudo systemctl stop hostapd
    sudo systemctl stop dnsmasq

    # Enable wpa_supplicant for wlan0
    sudo sed -i '/^nohook wpa_supplicant/d' /etc/dhcpcd.conf
    sudo systemctl restart dhcpcd
    sudo systemctl start wpa_supplicant

    # Restart the Wi-Fi interface
    sudo ifdown wlan0
    sudo ifup wlan0
    sudo hostapd /etc/hostapd/hostapd.conf &
    sudo dhclient wlan0

    echo "Switched to Eduroam!"
}

# Function to switch to Hotspot
switch_to_hotspot() {
    echo "Switching to Hotspot..."
    # Stop wpa_supplicant
    sudo systemctl stop wpa_supplicant

    # Add nohook for wpa_supplicant in dhcpcd.conf
    if ! grep -q "nohook wpa_supplicant" /etc/dhcpcd.conf; then
        echo "nohook wpa_supplicant" | sudo tee -a /etc/dhcpcd.conf
    fi
    sudo systemctl restart dhcpcd

    # Set static IP for wlan0
    sudo ifconfig wlan0 192.168.4.1

    # Start hostapd and dnsmasq
    sudo systemctl start hostapd
    sudo systemctl start dnsmasq

    echo "Hotspot is now active!"
}

if [ $# -ne 1 ]; then
	echo "Usage: $0 <eduroam|hotspot>"
	exit 1
fi

case $1 in
	eduroam)
		switch_to_eduroam
		;;
	hotspot)
		switch_to_hotspot
		;;
	*)
		echo "Invalid argument. Use 'eduroam' or 'hotspot'."
		exit 1
		;;
esac